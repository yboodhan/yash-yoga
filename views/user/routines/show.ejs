<h1><%= routine.name %></h1>

<button type="button" id="start_routine_button"><i class="fa fa-play-circle"></i> Start Routine</button>

<hr>

<div class="container col-10">

  <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">

    <!-- Wrapper for slides -->
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img class="d-block w-50 mx-auto" src="<%= routine.poses[0].img_url %>" alt="yoga pose">
      </div>

      <% let poses =  routine.poses.slice(1) %>

      <% poses.forEach( (pose) => { %>
        <% let duration = parseInt(pose.routines_poses.duration) * 1000 %>
        <div class="carousel-item" data-interval="<%= duration %>">
          <img class="d-block w-50 mx-auto" src="<%= pose.img_url %>" alt="yoga pose">
          <p>POSE <%= pose.id %></p>
        </div>
      <% }) %>

    </div>

    <!-- Left and right controls -->
    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon control" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
      <span class="carousel-control-next-icon control" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>

  </div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script>

var t;

var start = $('.carousel').find('.active').attr('data-interval');

t = setTimeout("$('.carousel').carousel({interval: 1000});", start-1000);

$('.carousel').on('slid.bs.carousel', function () {  
     clearTimeout(t);  
     var duration = $(this).find('.active').attr('data-interval');
    
     $('.carousel').carousel('pause');
     t = setTimeout("$('.carousel').carousel();", duration-1000);
})

$('.carousel-control-next').on('click', function(){
    clearTimeout(t);   
});

$('.carousel-control-prev').on('click', function(){
    clearTimeout(t);   
});

</script>